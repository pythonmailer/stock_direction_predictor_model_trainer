name: CI Pipeline

# 1. TRIGGERS
# This pipeline runs whenever you 'push' code or open a 'pull_request'.
on: [push, pull_request]

jobs:
  build-test:
    # 2. ENVIRONMENT
    # It rents a fresh Ubuntu Linux virtual machine from GitHub.
    runs-on: ubuntu-latest
    
    steps:
      # 3. CHECKOUT
      # Downloads your code from the repo into the virtual machine.
      - name: Checkout Code
        uses: actions/checkout@v3

      # 4. SETUP PYTHON
      # Installs Python 3.10 on that machine.
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 5. INSTALL DEPENDENCIES
      # Installs libraries from your requirements.txt (Polars, Torch, etc.)
      # Also installs 'flake8' (linter) and 'pytest' (tester).
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install flake8 pytest
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # 6. LINTING (Code Quality Check)
      # Checks for syntax errors or unused variables using Flake8.
      # If your code is "dirty", it fails here before running tests.
      - name: Lint with Flake8 (Check Code Quality)
        run: |
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics

      # 7. TESTING (The Critical Part)
      # Runs 'pytest'. This looks for any file starting with 'test_' or ending in '_test.py'
      # and runs the functions inside them.
      - name: Run Tests
        run: |
          pytest